/**
 *   @file    utils.c
 *   @author  Vlad-Eusebiu Baciu
 *   @brief   Utils library
 *   @details Includes common functions, macros for all the
 *            custom libraries.
 *            
 */

/*==================================================================================================
 *
 * Copyright Vrije Universiteit Brussel, 2021
 * All Rights Reserved
 * UNPUBLISHED, LICENSED SOFTWARE.
 *
 *  ==============================================================================================*/


/*==================================================================================================
 *                                        INCLUDE FILES
 * 1) system and project includes
 * 2) needed interfaces from external units
 * 3) internal and external interfaces from this unit
 *  ==============================================================================================*/
#include "utils.h"

#include <cmsis_gcc.h>
#include <stdint.h>
#include "cyhal.h"

#include "oled_driver.h"
/*==================================================================================================
 *                          LOCAL TYPEDEFS (STRUCTURES, UNIONS, ENUMS)
 *  ==============================================================================================*/


/*==================================================================================================
 *                                       LOCAL MACROS
 *  ==============================================================================================*/


/*==================================================================================================
 *                                      LOCAL CONSTANTS
 *  ==============================================================================================*/


/*==================================================================================================
 *                                      LOCAL VARIABLES
 *  ==============================================================================================*/



/*==================================================================================================
 *                                      GLOBAL CONSTANTS
 *  ==============================================================================================*/


/*==================================================================================================
 *                                      GLOBAL VARIABLES
 *  ==============================================================================================*/

/*==================================================================================================
 *                                   LOCAL FUNCTION PROTOTYPES
 *  ==============================================================================================*/

/*==================================================================================================
 *                                   GLOBAL FUNCTION PROTOTYPES
 *  ==============================================================================================*/

/*==================================================================================================
 *                                       LOCAL FUNCTIONS
 *  ==============================================================================================*/


/*==================================================================================================
 *                                       GLOBAL FUNCTIONS
 *  ==============================================================================================*/



/***************************************************************************
 * Function: displayStringArray
 *
 * Description: Display text on OLED LCD
 **************************************************************************/
void displayStringArray(uint8_t *pStringBuffer, uint16_t buffLen, uint8_t textSize, uint32_t coords)
{
    display_clear();
    gfx_setTextColor(WHITE);
    gfx_setTextSize(textSize);
    gfx_setCursor((coords >> 16U) & 0xFF, coords & 0xFF);
    for(uint8_t i = 0 ; i < buffLen ; i++){
            gfx_write(*(pStringBuffer + i));
      }

    display_update();
    CyDelay(800);
    display_clear();
}

/***************************************************************************
 * Function: HandleError    
 *
 * Description: Disable IRQ and enter an infinite loop.
 **************************************************************************/
void HandleError(void)
{   
     /* Disable all interrupts. */
	__ASM volatile ("cpsid i" : : : "memory");
    
    /* Infinite loop. */
    while(1u) {}
}
